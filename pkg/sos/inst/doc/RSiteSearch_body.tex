\title{Searching help pages of R packages}
\author{by Spencer Graves, Sundar Dorai-Raj, and Romain Francois}

\maketitle

The {\tt sos} package provides a means to quickly and flexibly
search the help pages of contributed packages, finding
functions and datasets in seconds or minutes that could not be
found in hours or days by any other means we know.

The main capability of this package is the {\tt findFn} function,
which scans the "function" entries in Jonathan
Baron's RSiteSearch data base and returns the matches in a
{\tt data.frame} of class {\tt findFn}.  The corresponding
{\tt print} method displays the results as a table in a web
browser with links to the individual help pages, sorted by package
displaying the one with the most matches first.  Other {\tt sos}
functions provide summaries with one line for each package, support
the union and intersection of {\tt findFn} objects, and write the
results to an Excel file with three sheets:  (1) {\tt PackageSum2},
which provides an enhanced summary of the packages with matches,
(2) the {\tt findFn} table itself, and (3) the {\tt call} used to
produce it.

Other \R{} functions can then be used to quickly find what you want
among possibly hundreds of matches.

Two examples are considered below:  First we find a dataset
containing a variable {\tt Petal.Length}, used without indicating
the source by Chambers 

... how to cite?  
%\citeauthoryear{JC09}.
w/o page numbers
cite \cite{JC09}.
citet \citet{JC09}.

citep \citep{JC09}.

with page numbers
cite \cite[pp. 282-283]{JC09}.
citet \citet[pp. 282-283]{JC09}.

citep \citep[pp. 282-283]{JC09}.

Second, we study \R{} capabilities
for splines, including looking for a function named {\tt spline}.

\section*{Petal.Length}

\citep[pp. 282-283]{JC09}
Chambers (2009, p. 282-283) uses a variable {\tt Petal.Length} from a
famous Fisher data set but without naming the dataset nor indicating
where it can be found nor even if it exists in \R{}.  The sample
code he provides does not work by itself.  To reproduce his
Figure 7.2, we must first obtain a copy of this famous data set
in a format compatible with Chambers' code.

How to add Bibliography ?
Chambers, John (2009) Software for Data Analysis (Springer)

To look for this data set, one might first try
the {\tt help.search} function.  Unfortunately, this function
returns nothing in this case:
\begin{verbatim}
> help.search('Petal.Length')
No help files found ...
\end{verbatim}
When this failed, many users might then try
{\tt RSiteSearch('Petal.Length')}.  This produced 80 matches
when it was tried one day (and 62 matches a few months later).
{\tt RSiteSearch('Petal.Length', 'function')} will identify
only the help pages.  We can get something similar and for
many purpose more useful as follows:
\begin{verbatim}
> library(sos)
> PL <- findFn('Petal.Length')
\end{verbatim}
{\tt PL} is a {\tt data.frame} of class {\tt findFn} identifying
all the help pages in Jonathan Baron's data base matching the
search term.

The {\tt summary} method for such an object prints a table giving
for each {\tt Package} the {\tt Count} (number of matches),
{\tt MaxScore} (max of {\tt Score}), {\tt TotalScore} (sum of
{\tt Score}), and {\tt Date}, sorted like a Pareto chart to place
the {\tt Package} with the most help pages first:
\begin{verbatim}
> summary(PL)

Total number of matches: 27
Downloaded 27 links in 14 packages.
Packages with at least 1 match using search
                      pattern 'Petal.Length':
Package Count MaxScore TotalScore       Date
yaImpute    8        1          8 2009-08-16
<...>
datasets    1        2          2 2009-07-09
<...>
\end{verbatim}
One of the listed packages is {\tt datasets}.  Since it is part of the
default \R{} distribution, we decide to look there first.  We can
select that row of PL just like we would select a row from any other
data.frame:
\begin{verbatim}
> PL[PL$Package=='datasets', 'Function']
[1] iris
\end{verbatim}
Problem solved in less than a minute!  Any other method known
to the present authors would have taken substantially more time.

\section*{spline}

Three years ago, the lead author of this article decided he
needed to learn more about splines.  A literature search
began as follows:
\begin{verbatim}
RSiteSearch('spline')
\end{verbatim}
While preparing this manuscript, this command identified
1526 documents one day.  That is too many.  It can be
restricted to functions as follows:
\begin{verbatim}
RSiteSearch('spline', 'fun')
\end{verbatim}
This identified only 739 one day (631 a few months earlier).
That's an improvement over 1526 but is still too many.
To get a quick overview of these 739, we can proceed
as follows:
\begin{verbatim}
splinePacs <- findFn('spline')
\end{verbatim}
This downloaded a summary of the 400 highest-scoring help pages
in the 'RSiteSearch' data base in roughly 5-15 seconds, depending
on the speed of the Internet connection.  To get all 739 matches,
increase the {\tt maxPages} argument from its default 20:
\begin{verbatim}
splineAll <- findFn('spline', maxPages=999)
\end{verbatim}
The {\tt print} method for a {\tt findFn} object displays the
result as a table in a web browser.

However, a table with 739 rows is rather large to digest easily.
{\tt summary(splineAll)} would tell us that the 739 help pages
came from 191 different packages and display the first
minPackages = 12 plus others with that number of matches.









A more complete view can be obtained in MS Excel format
using the {\tt writeFindFn2xls} function:
\begin{verbatim}
writeFindFn2xls(splineAll)
\end{verbatim}
If either the {\tt WriteXLS} package and compatible Perl code
are properly installed or if you are running Windows with
the {\tt RODBC} package, this produces an Excel file with
three sheets:

The {\tt PackageSum2} sheet contains information on locally
installed packages not available {\tt summary}.

The {\tt findFn} sheet contains the search results.

The {\tt call} sheet gives the call to {\tt findFn}
that generated these search results.

If {\tt WriteXLS} cannot produce an Excel file with your
installation, it will write three *.csv files.  (NOTE:
An Excel file can be opened and edited with Open Office
Calc


citation for Open Office Calc?
)

The {\tt PackageSum2} sheet (or file) is created by the
{\tt PackagesSum2} function, which adds information from
installed packages not obtained on all functions by
{\tt findFn}.  This includes names of author and maintainer,
the date packaged, the number of help pages in the package,
and the name(s) of any vignettes.  This can be quite
valuable in prioritizing packages for further study.

To install packages not already available locally,
the names of the desired packages can be passed to
{\tt install.packages}.  To simplify this task, the
{\tt findFn} object can be passed to the {\tt installPackages}
function to check all packages for which the number of
matches exceeds a second argument {\tt minCount} and
install any that are not already installed;  the default
{\tt minCount} is the square root of the largest {\tt Count}.
The results from {\tt PackageSum2} and the {\tt PackageSum2}
sheet of {\tt writeFindFn2xls} will typically contain
more information after running {\tt installPackages}
than before.





Returning to the {\tt findFn} object, suppose we want
to find a function named {\tt spline}.  For this, we can
proceed as follows:
\begin{verbatim}
selSpl <- (splineAll[,'Function']=='spline')
splineAll[selSpl, ]
\end{verbatim}
This has 0 rows, because there is no help page named
{\tt spline}.  This does not mean that no function
with that exact name exists, only that no help page
has that name.  To find a function with that exact
name, try {findFn('spline(')}.

This search can be generalized using {\tt grepFn}:
\begin{verbatim}
> grepFn('spline', splineAll, ignore.case=TRUE)
\end{verbatim}
This returned a {\tt findFn} object identifying 60 help pages.
The {\tt print} method for an object of class {\tt findFn}
presents the result in a web browser.  In this case,
the fifth row is 'lspline' in the
'assist' package, which has a {\tt Score} of 1.  It
is the fifth row in this table, because it is in the
{\tt assist} package, which had a total of 34 help
pages matching the search term, and this was the only
one whose name (as opposed to contents) matched the
{\tt grep} {\tt pattern}.








To establish priorities among different packages for further study, it
might be nice to have a Pareto chart showing the 10 packages with the
most help pages relevant to our search {\tt string}.  We can get this as
follows:
\begin{verbatim}
> spSm <- attr(splineAll,'PackageSummary')
> spSm[1:10,'Count']
    assist     fda           gss      mgcv
        34      30            25        22
      VGAM kernlab DierckxSpline bayesSurv
        17      17            16        16
smoothSurv splines
        15      14
\end{verbatim}
To obtain a similar Pareto by 'TotalScore' requires a little more
effort:
\begin{verbatim}
> o <- rev(order(spSm[, 'TotalScore']))
> splineSum[o, ][1:10, ]
              Count MaxScore TotalScore
gss              25       35        448
splines          14       45        354
fda              30       48        275
<...>
\end{verbatim}
This analysis gave us in seconds a very informative overview of {\tt
spline} capabilities in contributed \R{} packages in a way that can help
establish priorities for further study of the different packages and
functions.

\section*{HTML}
The {\tt HTML} function writes an {\tt RSiteSearch} object to a file
in HTML format and opens it in a browser from which a mouse click will
open a desired help page.

The power of this can be seen by applying this function to the
{\tt grep'ed} subset of help pages with names including the phrase
{\tt spline}:

\begin{verbatim}
HTML(splineAll[select, ])
\end{verbatim}

Of the 631 help pages containing {\tt spline}, this displayed only
those whose name included the phrase {\tt spline}.  Similar analyses
could display any desired subset of an {\tt RSiteSearch} object
created from merging several calls to {\tt RSiteSearch.function}.

\section*{Summary}
In sum, we have found {\tt RSiteSearch.function} in the {\tt
RSiteSearch} package to be a very quick and efficient method for
finding things in contributed packages.

\section*{Acknowledgments}
The {\tt RSiteSearch} capabilities here extend the power of the
{\tt RSiteSearch} search engine maintained by Jonathan Baron.
Without Prof. Baron's support, it would not have been feasible
to develop the features described here.  Duncan Murdoch, Marc Schwarz,
Dirk Eddelbuettel and Gabor Grothendiek and anonymous
referees contributed suggestions for improving, but of course
can not be blamed for any of its deficiencies.
\newline \newline
\emph{Spencer Graves \newline
President and Chief Operating Officer \newline
Structure Inspection and Monitoring \newline
San Jose, CA \newline
email:  {\tt spencer.graves@prodsyse.com} }
\newline \newline
\emph{Sundar Dorai-Raj \newline
Google \newline
Mountain View, CA \newline
email:  {\tt sdorairaj@google.com} }
\newline \newline
\emph{Romain Francois \newline
\newline
\newline
email:  {\tt romain.francois@dbmail.com} }

