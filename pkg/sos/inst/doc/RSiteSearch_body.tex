\title{Searching help pages of R packages}
\author{by Spencer Graves, Sundar Dorai-Raj, and Romain Fran{\c c}ois}

\maketitle

The {\tt sos} package provides a means to quickly and flexibly
search the help pages of contributed packages, finding
functions and datasets in seconds or minutes that could not be
found in hours or days by any other means we know.

The main capability of this package is the {\tt findFn} function,
which scans the "function" entries in Jonathan

Baron's "R site search"

need a bibliography entry for Baron's "R site search"

data base and returns the matches in a
{\tt data.frame} of class {\tt findFn}.  Baron's is one of five
search capabilities currently identified under "search" from the
main "www.r-project.org" web site.  It includes options to
search both R mailing list archives plus the help pages of
R packages contributed to CRAN (the Comprehensive R Archive
Network) plus a few others.

The {\tt print} method for objects of class {\tt findFn}
displays the results as a table in a web
browser with links to the individual help pages, sorted by package
displaying the one with the most matches first.  This is different
from the {\tt RSiteSearch} function, as {\tt findFn} returns
the results in \R{} as a {\tt data.frame}, which can be further
manipulated, and the ultimate display in a web browser is a
table, unlike the list produced by {\tt RSiteSearch}.

Other {\tt sos} functions provide summaries with one line for each
package, support the union and intersection of {\tt findFn} objects,
and write the results to an Excel file with three sheets:  (1)
{\tt PackageSum2}, which provides an enhanced summary of the packages
with matches, (2) the {\tt findFn} table itself, and (3) the {\tt call}
used to produce it.

Three examples are considered below:  First we find a dataset
containing a variable {\tt Petal.Length}, used without indicating
the source by Chambers

... how to cite?
%\citeauthoryear{JC09}.
w/o page numbers
cite \cite{JC09}.
citet \citet{JC09}.

citep \citep{JC09}.

with page numbers
cite \cite[pp. 282-283]{JC09}.
citet \citet[pp. 282-283]{JC09}.

citep \citep[pp. 282-283]{JC09}.

Second, we study \R{} capabilities
for splines, including looking for a function named {\tt spline}.  Third,
we search for contributed \R{} packages with capabilities for solving
differential equations.

\section*{Finding a Variable in a Data Set:  Petal.Length}

\citep[pp. 282-283]{JC09}
Chambers (2009, p. 282-283) uses a variable {\tt Petal.Length} from a
famous Fisher data set but without naming the dataset nor indicating
where it can be found nor even if it exists in any contributed \R{}
package.  The sample code he provides does not work by itself.  To get
his code to  work to produce his Figure 7.2, we must first obtain a
copy of this famous data set in a format compatible with his code.

How to add Bibliography ?
Chambers, John (2009) Software for Data Analysis (Springer)

To look for this data set, one might first try
the {\tt help.search} function.  Unfortunately, this function
returns nothing in this case:
\begin{verbatim}
> library(sos)
> help.search('Petal.Length')
No help files found ...
\end{verbatim}
When this failed, many users might then try
{\tt RSiteSearch('Petal.Length')}.  This produced 80 matches
when it was tried one day (and 62 matches a few months later).
{\tt RSiteSearch('Petal.Length', 'function')} will identify
only the help pages.  We can get something similar and for
many purpose more useful as follows:
\begin{verbatim}
> library(sos)
> PL <- findFn('Petal.Length')
\end{verbatim}
{\tt PL} is a {\tt data.frame} of class {\tt findFn} identifying
all the help pages in Jonathan Baron's data base matching the
search term.  An alias for "findFn" is "???", and this same 
search can be performed as follows:  
\begin{verbatim}
> PL <- ???Petal.Length
\end{verbatim}
This {\tt data.frame} has columns {\tt Count},
{\tt MaxScore}, {\tt TotalScore}, {\tt Package}, {\tt Function},
{\tt Date}, {\tt Score}, {\tt Description}, and {\tt Link}.
{\tt Function} is the name of the help page, not the name of the
function, as multiple functions may be documented on a single
help page, and some help pages document other things such as data
sets.  {\tt Score} is the index of the strength of the match used
by Baron's search engine to decide which items to display first.
{\tt Package} is the name of the package containing {\tt Function}.
{\tt Count} gives the total number of matches found in this
{\tt findFn} call.  By default, the {\tt findFn} object is sorted
to present first the most important {\tt Package} first (sorting first
by {\tt Count}, {\tt MaxScore},  {\tt TotalScore}, and {\tt Package}
in case multiple packages have the same number of matches to the
search string), then placing the {\tt Function} with the highest
{\tt Score} first within each {\tt Package}.

The {\tt summary} method for such an object prints a table giving
for each {\tt Package} the {\tt Count} (number of matches),
{\tt MaxScore} (max of {\tt Score}), {\tt TotalScore} (sum of
{\tt Score}), and {\tt Date}, sorted like a Pareto chart to place
the {\tt Package} with the most help pages first:
\begin{verbatim}
> summary(PL)

Total number of matches: 27
Downloaded 27 links in 14 packages.
Packages with at least 1 match using search
                      pattern 'Petal.Length':
Package Count MaxScore TotalScore       Date
yaImpute    8        1          8 2009-08-16
<...>
datasets    1        2          2 2009-07-09
<...>
\end{verbatim}
One of the listed packages is {\tt datasets}.  Since it is part of the
default \R{} distribution, we decide to look there first.  We can
select that row of PL just like we would select a row from any other
data.frame:
\begin{verbatim}
> PL[PL$Package=='datasets', 'Function']
[1] iris
\end{verbatim}
Problem solved in less than a minute!  Any other method known
to the present authors would have taken substantially more time.

\section*{Finding Packages with Spline Capabilities}

Three years ago, the lead author of this article decided he
needed to learn more about splines.  A literature search
began as follows:
\begin{verbatim}
RSiteSearch('spline')
\end{verbatim}
(using the {\tt RSiteSearch} function in the {\tt utils} package).
While preparing this manuscript, this command identified
1526 documents one day.  That is too many.  It can be
restricted to functions as follows:
\begin{verbatim}
RSiteSearch('spline', 'fun')
\end{verbatim}
This identified only 739 one day (631 a few months earlier).
That's an improvement over 1526 but is still too many.
To get a quick overview of these 739, we can proceed
as follows:
\begin{verbatim}
splinePacs <- findFn('spline')
\end{verbatim}
This downloaded a summary of the 400 highest-scoring help pages
in the 'RSiteSearch' data base in roughly 5-15 seconds, depending
on the speed of the Internet connection.  To get all 739 matches,
increase the {\tt maxPages} argument from its default 20:
\begin{verbatim}
splineAll <- findFn('spline', maxPages=999)
\end{verbatim}
The {\tt print} method for a {\tt findFn} object displays the
result as a table in a web browser.

If we want to find a function named {\tt spline}, we can
proceed as follows:
\begin{verbatim}
selSpl <- (splineAll[,'Function']=='spline')
splineAll[selSpl, ]
\end{verbatim}
This has 0 rows, because there is no help page named
{\tt spline}.  This does not mean that no function
with that exact name exists, only that no help page
has that name.  To find a function with that exact
name, try {findFn('spline(')}.  This produced one match
for a function named 'regspline'.

To look for functions whose name includes the characters 'spline',
we can use {\tt grepFn}:
\begin{verbatim}
grepFn('spline', splineAll, ignore.case=TRUE)
\end{verbatim}
This returned a {\tt findFn} object identifying 78 help pages.
The {\tt print} method for an object of class {\tt findFn}
presents the result in a web browser.  In this case,
the sixth row is 'lspline' in the
'assist' package, which has a {\tt Score} of 1.  It
is the fifth row in this table, because it is in the
{\tt assist} package, which had a total of 34 help
pages matching the search term, and this was the only
one whose name matched the {\tt grepFn} {\tt pattern}.

To try to evaluate further the {\tt splineAll} {\tt findFn}
object, we must first acknowledge that a table with 739 rows
is too large to digest easily.

{\tt summary(splineAll)} would tell us that the 739 help pages
came from 191 different packages and display the first
minPackages = 12.  (If other packages had the same number of
matches as the twelfth package, they would also appear in the
summary.)

A more complete view can be obtained in MS Excel format
using the {\tt writeFindFn2xls} function:
\begin{verbatim}
writeFindFn2xls(splineAll)
\end{verbatim}
If either the {\tt WriteXLS} package and compatible Perl code
are properly installed or if you are running Windows with
the {\tt RODBC} package, this produces a '*.xls' Excel file
with three sheets:

The {\tt PackageSum2} sheet contains information on locally
installed packages not available {\tt summary}.

The {\tt findFn} sheet contains the search results.

The {\tt call} sheet gives the call to {\tt findFn}
that generated these search results.

If {\tt WriteXLS} cannot produce an Excel file with your
installation, it will write three *.csv files.  (NOTE:
Users who do not have MS Excel may like to know that
Open Office Calc can open a standard '*.xls' file and
can similarly create such files.


citation for Open Office Calc?
)

The {\tt PackageSum2} sheet (or file) is created by the
{\tt PackagesSum2} function, which adds information from
installed packages not obtained on all functions by
{\tt findFn}.  This includes names of author and maintainer,
the date packaged, the number of help pages in the package,
and the name(s) of any vignettes.  This can be quite
valuable in prioritizing packages for further study.

For packages not already installed, the standard
{\tt install.packages} function can be used.  To simplify this
task, the {\tt findFn} object can be passed to the
{\tt installPackages} function to check all packages for which
the number of matches exceeds a second argument {\tt minCount}
and install any of those that are not already installed;  the
default {\tt minCount} is the square root of the largest
{\tt Count}.  The results from {\tt PackageSum2} and the
{\tt PackageSum2} sheet of {\tt writeFindFn2xls} will typically
contain more information after running {\tt installPackages}
than before.

This analysis quickly gave us a very informative overview of
{\tt spline} capabilities in contributed \R{} packages in a way
that can help establish priorities for further study of the
different packages and functions.  An analysis of this nature 
almost four years ago led the lead author to the {\tt fda} 
package and its companion books, which further led to a 
collaboration that has joint presentations at three different
conferences and a joint book 

\citep{RHG09}

.  


\section*{Combining Search Results to Find Functions to Solve Differential Equations}

The lead author of this article recently gave an invited 
presentation on "Fitting Nonlinear Differential Equations to 
Data in R" 

\cite{GHR09} 

.  A key part of preparing for that presentation was a search 
of contributed R code, which proceeded roughly as follows:  

\begin{verbatim}
de <- findFn('differential equation') 
des <- findFn('differential equations')
de. <- de | des 
\end{verbatim}

The object {\tt de} has 53 rows, while {\tt des} has 105.  
If this search engine were simply searching for character 
strings, the first would be larger than the second rather than 
the other way around.  The last object {\tt de.} is the union
of the other two;  "|" is an alias for {\tt unionFindFn}.  
The {\tt de.} object has 124 rows, which suggests that 
the corresponding intersection must have (53+105-124) = 34, which 
is confirmed, e.g., via {\tt nrow(de \& des)}.  

To make everthing in {\tt de.} locally available, we can use 
{\tt installPackages(de., minCount=1)}.  This installed all 
referenced packages except 'rmutil' and a dependency 'Biobase', 
which were not available on CRAN but are included in Jonathan 
Baron's "R site search" data base.  

Next, {\tt writeFindFn2xls(de.)} produced a file {\tt de..xls} 
in the working directory (identifiable via {\tt getwd()}).  

The {\tt PackageSum2} page of that Excel file provided a quick 
summary of packages with matches, sorted to put the package 
with the most matches first.  In this case, this first package 
was {\tt deSolve}, which provides, "General solvers for initial 
value problems of ordinary differential equations (ODE), 
partial differential equations (PDE) and differential 
algebraic equations (DAE)".  This is clearly quite relevant 
to the subject.  The second package was {\tt PKfit}, which 
is "A Data Analysis Tool for Pharmacokinetics".  This may 
be too specialized for general use.  I therefore would not 
want to study this first unless my primary interest here was in 
pharmacokinetic models.  

By studying this summary page in this way, I was able to decide 
relatively quickly which packages I should consider first.  In 
making this decision, I gave more weight to packages with 
one or more vignettes and less weight on those where the 
'Packaged' date was old, indicating that the code was not being 
actively maintained and updated.  I also checked the conference 
information to make sure I didn't embarrass myself by overlooking 
a package authored or maintained by another invited speaker.  


\section*{Discussion}
In sum, we have found {\tt findFn} in the {\tt sos} package to
be a very quick and efficient method for finding things in
contributed packages.  The {\tt grepFn} function helps quickly 
look for functions (or help pages) with particular names.  
The {\tt unionFindFn} and {\tt intersectFindFn} (especially via 
their "|" and "\&" aliases) can be quite useful where a single 
search term seems inadequate and multiple searches can be 
combined to produce something closer to what is desired.  
An example of this was provided with searching for both
"differential equation" and "differential equations".  

Finally, the "PackageSum2" sheet of an excel file produced by 
{\tt writeFindFn2xls} is quite valuable for understanding the 
general capabilities available for a particular topic.  
This could be of great value for authors to find what is already 
available so they don't duplicate something that already exists 
and so their new contributions are compatible to the maximum extent
feasible with other packages.  

The {\tt findFn} capability also makes it much easier 
to avoid "the researcher's nightmare" of being told after 
substantial work that someone else has already done essentially 
the same thing.  


\section*{Acknowledgments}
The {\tt RSiteSearch} capabilities here extend the power of the
{\tt RSiteSearch} search engine maintained by Jonathan Baron.
Without Prof. Baron's support, it would not have been feasible
to develop the features described here.  Duncan Murdoch, Marc Schwarz,
Dirk Eddelbuettel and Gabor Grothendiek and anonymous
referees contributed suggestions for improving, but of course
can not be blamed for any of its deficiencies.  The collaboration
required to produce the current {\tt sos} package was greatly
facilitated by R-Forge

cite ... ???


The {\tt sos} package is part of the {\tt RSiteSearch} project
hosted there.  This project also includes code for a Firefox
extension to simplify the process of finding information about
\R{}.
\newline \newline
\emph{Spencer Graves \newline
President and Chief Operating Officer \newline
Structure Inspection and Monitoring \newline
San Jose, CA \newline
email:  {\tt spencer.graves@prodsyse.com} }
\newline \newline
\emph{Sundar Dorai-Raj \newline
Google \newline
Mountain View, CA \newline
email:  {\tt sdorairaj@google.com} }
\newline \newline
\emph{Romain Fran{\c c}ois \newline
\newline
\newline
email:  {\tt romain.francois@dbmail.com} }

